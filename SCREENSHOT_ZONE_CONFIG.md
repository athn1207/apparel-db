# 座標固定で読み取る（screenshot_config.json）

OCR の読み取り位置を**画像内の固定した範囲だけ**にしたいときは、プロジェクト直下に **screenshot_config.json** を置き、次のように書きます。

## 何を伝えれば「必ずここを読む」になるか

**「ブランド名」と「商品名」が、画像のどのあたりに写っているか**を、**画像の幅・高さに対する割合（0〜1）**で指定します。

- **ブランド** … 「項目：ブランド」のラベルと、その右隣のブランド名（例：JACOB COHEN）が**両方入る四角い範囲**
- **商品名** … メルカリのタイトル（【人気モデル】… など）が**入る四角い範囲**

指定した範囲**外**のテキストは読みに行かず、範囲**内**のテキストだけを使ってブランド・商品名を決めます。

---

## 設定ファイルの書き方

**screenshot_config.json**（プロジェクトの直下、`apparel-db` フォルダの中）に、次のような JSON を書きます。

```json
{
  "brand_zone": {
    "y_min": 0.38,
    "y_max": 0.52,
    "x_min": 0.15,
    "x_max": 0.92
  },
  "product_name_zone": {
    "y_min": 0.35,
    "y_max": 0.52,
    "x_min": 0.05,
    "x_max": 0.95
  }
}
```

### 各値の意味（0 以上 1 以下）

| キー | 意味 |
|------|------|
| **y_min** | 範囲の**上端**。画像の高さの何割の位置か（0＝一番上、0.5＝中央） |
| **y_max** | 範囲の**下端**。画像の高さの何割の位置か |
| **x_min** | 範囲の**左端**。画像の幅の何割の位置か（0＝一番左） |
| **x_max** | 範囲の**右端**。画像の幅の何割の位置か |

- **brand_zone** … ここで指定した四角の**中にあるテキストだけ**をブランド読み取りに使います。  
  **「L・JACOB COHEN・目立った傷や汚れなし」のような1行**のときは、**1番目と2番目の ・（中黒）の間**の文字列（この例なら `JACOB COHEN`）をブランド名として使います。
- **product_name_zone** … ここで指定した四角の**中にあるテキストだけ**を商品名として使います。【人気モデル】からサイズ・色までの**2行のタイトルだけ**が入るように、商品名ゾーンは**ブランドの行より上**（y_max を小さく）にするとずれません。

---

## 割合の決め方（ざっくり）

1. スクショを**画像ビューアやペイント**で開く。
2. **ブランド**が写っている範囲を思い浮かべ、「項目：ブランド」と「JACOB COHEN」が含まれる四角を考える。
   - その四角の**上端**が画像の上から何割か → **y_min**（例：0.38）
   - **下端**が画像の上から何割か → **y_max**（例：0.52）
   - **左端**が画像の左から何割か → **x_min**
   - **右端**が画像の左から何割か → **x_max**
3. **商品名**も同様に、【人気モデル】～サイズ・色が入る四角で、上端・下端・左端・右端を割合で決める。

ピクセルで分かっている場合は、**縦の位置 ÷ 画像の高さ**、**横の位置 ÷ 画像の幅**で 0〜1 に直します。

- 例：画像の高さ 800px で、範囲の上端が 300px → 300/800 = **0.375** → y_min: 0.38 など

---

## Mercari iPhone 用の領域OCR（Tesseract）

**use_mercari_iphone_ocr: true** にすると、EasyOCR の代わりに **Tesseract** で領域だけを切り出して読みます（解像度例: 1179x2556）。

- **brand_region** … ブランド行の範囲（既定: X 5%–95%, Y 60%–68%）。ここを読んだあと、「・」で区切って 2 番目のブロックをブランド名にします。
- **product_region** … 商品名の範囲（既定: X 5%–95%, Y 40%–48%）。ここを読んだテキストから UI 用語・価格を除いて商品名にします。

 crop の割合は **brand_region** / **product_region** の **x_min, x_max, y_min, y_max**（0〜1）で調整できます。  
 Tesseract 本体のインストールが必要です（例: Windows は [Tesseract at GitHub](https://github.com/UB-Mannheim/tesseract/wiki)、Mac は `brew install tesseract tesseract-lang`）。

---

## 注意

- **screenshot_config.json を置かない**場合は、これまで通りスクリプト内の既定の範囲で読みます。
- ファイルがあると、**必ずその範囲だけ**を参照するようになります。範囲を狭くしすぎると「ブランド」やタイトルが外れて読めなくなるので、少し余裕を持たせて指定してください。
